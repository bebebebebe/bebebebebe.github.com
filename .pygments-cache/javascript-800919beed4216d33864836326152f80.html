<div class="highlight"><pre><span class="kd">var</span> <span class="nx">GET_crashers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">cutoffDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span> <span class="nx">cutOffTime</span> <span class="o">*</span> <span class="mi">1000</span> <span class="p">)</span> <span class="p">);</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span> <span class="nx">dbCrashers</span><span class="p">,</span> <span class="p">[</span> <span class="nx">maxTries</span><span class="p">,</span> <span class="nx">cutoffDate</span> <span class="p">],</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">rows</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nx">err</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">err</span> <span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span> <span class="nx">err</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="mi">500</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span> <span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/html; charset=UTF-8&#39;</span> <span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span> <span class="mi">200</span> <span class="p">);</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&#39;</span> <span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;No titles crash the testers!  All\&#39;s well with the world!&#39;</span> <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;&lt;h1&gt; The following &#39;</span> <span class="o">+</span> <span class="nx">n</span> <span class="o">+</span> <span class="s1">&#39; titles crash the testers&#39;</span> <span class="o">+</span>
                  <span class="s1">&#39; at least &#39;</span> <span class="o">+</span> <span class="nx">maxTries</span> <span class="o">+</span> <span class="s1">&#39; times&lt;/h1&gt;&#39;</span> <span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;&lt;ul&gt;&#39;</span> <span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">prefix</span><span class="p">,</span>
            <span class="nx">title</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">title</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/wiki$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.wikipedia.org/wiki/&#39;</span> <span class="o">+</span> <span class="nx">title</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">title</span><span class="p">;</span>
          <span class="kd">var</span> <span class="nx">commitHash</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">claim_hash</span><span class="p">;</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;&lt;li&gt;&#39;</span> <span class="o">+</span> <span class="nx">commitHash</span> <span class="o">+</span> <span class="s1">&#39;: &lt;a href=&quot;http://&#39;</span> <span class="o">+</span>
                <span class="nb">encodeURI</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="nx">name</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&lt;/li&gt;\n&#39;</span> <span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span> <span class="s1">&#39;&lt;/ul&gt;&#39;</span> <span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span> <span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="p">);</span>
<span class="p">};</span>
</pre></div>